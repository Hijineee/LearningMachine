<?xml version="1.0" encoding="UTF-8"?> <!-- 맵퍼파일 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="Admin">

  	<select id="userList" resultType="userDTO">
  		select * from user where u_authority IN (1,2,3)
  	</select>
  	<select id="userSearch" parameterType="string" resultType="userDTO">
  		select * from user where u_name LIKE '%' #{u_name } '%'	
  	</select>
  	<select id="studentLecture" parameterType="string" resultType="HashMap">
  		select * from user_lecture_view where u_id = #{u_id} group by l_code
  	</select>
  	<select id="studentReport" parameterType="string" resultType="HashMap"> 
  		select * from user_teacher_reported_View 
  		<if test = "u_id != null">
  			where u_id = #{u_id} and u_del = 0
  		</if>
  		<if test = "u_id == null">
  			where u_del = 0
  		</if>
  	</select>
  	
  	<insert id="report" parameterType="bannedDTO">
      INSERT INTO user_banned(u_id,admin_id, bu_reason) 
      VALUES (#{u_id}, #{admin_id},#{bu_reason})
   </insert>
 
 	<update id="userReport" parameterType="String">
 		update user set u_del = 2 where u_id = #{u_id}
 	</update>
 	<update id="back" parameterType="String">
 		update user set u_del = 0 where u_id = #{u_id}
 	</update>
 	
 	<delete id="backdelete" parameterType="String">
 		delete from user_banned where u_id=#{u_id}
 	</delete>
 	
 	<select id="teacherList" resultType="HashMap">
 		SELECT *,SUM(total_register)AS COUNT, COUNT(t_id) AS t_idcount from lecture_info_view GROUP BY t_id
 	</select>
 	
 	<select id="studentBanList" resultType="HashMap">
 		select * from user_banned
 	</select>
 	
 	<select id="teacherSerch" parameterType="String" resultType="HashMap">
 		SELECT *,SUM(total_register)AS COUNT, COUNT(t_id) AS t_idcount from lecture_info_view  
 		where t_nickname LIKE '%' #{t_nickname } '%' 		
 		group by t_nickname	
 	</select>
 	
 	<select id="refundList" resultType="hashmap">
 		select * from user_paymentRefund_view
 	</select>
 	

 	<select id="lectureRequest" parameterType="String" resultType="hashmap">
 		select * from lecture_apply where l_recognize = 0
 		<if test = "la_no != null">
  			and la_no = #{la_no}
  		</if>
  	</select>

 	<select id="teachervideo" parameterType="String" resultType="HashMap">
 		select * from lecture_info_view 

  	</select>
  	
  	<delete id="lecture_refund1" parameterType="String" >
  		delete from payment_refund_apply where p_no = #{p_no}
  	</delete>
  	
  	<update id="lecture_refund" parameterType="String" >
 		update payment_log set p_refund = 1 where p_no = #{p_no}
 	</update>
 	
 	<insert id="lectureGet" parameterType="com.learning.User.DTO.ULectureDTO">
		insert into lecture(t_id,l_code, l_curriculum, l_name, l_price) 
		values (#{t_id}, #{l_code},#{l_curriculum},#{l_name},#{l_price})
    </insert>
    
    <update id = "lectureGet2" parameterType="string">
    	update lecture_apply set l_recognize = 1 
    	where la_no = #{la_no} 
    </update>
    
    <update id = "lectureGet3" parameterType="string">
    	update lecture_apply set l_recognize = 2 
    	where la_no = #{la_no} 
    </update>
 	
 	
  </mapper>